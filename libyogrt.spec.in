# libyogrt.spec

# Declare rpmbuild --with/--without parameters
%bcond_without slurm
%bcond_without flux
%bcond_with lsf

Summary: @PACKAGE_NAME@
Name: @PACKAGE_TARNAME@
Version: @PACKAGE_VERSION@
Release: 1%{?dist}
License: Proprietary
Group: System Environment/Base
URL: @PACKAGE_URL@
Packager: Christopher J. Morrone <morrone2@llnl.gov>
Source0: %{name}-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
%if %{with flux}
BuildRequires: flux-core
Requires: flux-core
%endif
%if %{with slurm}
BuildRequires: slurm slurm-devel
Requires: slurm
%endif
%if %{with lsf}
BuildRequires: lsf-common
Requires: lsf-common
# The LSF RPM packages are poorly built.  lsf-common contains two libraries
# that we use, libbat.so and liblsf.so.  However the lsf-common package
# neither declares that it provides them, nor installs them in sane
# locations.  We need to prevent the internal dependency generator
# from including rpm requires for those two libraries to work around
# lsf-common's packaging deficiencies.
%global __requires_exclude ^lib\(bat|lsf\)\.so.*$
%endif

%description
A simple wrapper library that provides a unified get-remaining-time
interface for multiple parallel job scheduling systems.

%prep
%setup -q

%build
%configure LDFLAGS=-Wl,--build-id \
        %{?with_lsf:--with-lsf LSF_LIBDIR=/opt/ibm/spectrumcomputing/lsf/10.1/linux3.10-glibc2.17-ppc64le-csm/lib LSF_ENVDIR=/opt/ibm/spectrumcomputing/lsf/conf LSF_INCLUDEDIR=/opt/ibm/spectrumcomputing/lsf/10.1/include} \
        %{!?with_lsf:--without-lsf}
make

%install
rm -rf $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT
DESTDIR="$RPM_BUILD_ROOT" make install
mv $RPM_BUILD_ROOT%{_sysconfdir}/yogrt.conf.example $RPM_BUILD_ROOT%{_sysconfdir}/yogrt.conf

%files
%defattr(-,root,root,-)
%doc
%doc DISCLAIMER
%doc COPYING
%doc COPYING.LESSER
%doc INSTALL
%{_includedir}/yogrt.h
%{_libdir}/*.*
%{_libdir}/libyogrt/*
%{_mandir}/*/*
%config(noreplace) %{_sysconfdir}/yogrt.conf

%clean
rm -rf $RPM_BUILD_ROOT

%changelog
* Mon Feb 12 2007 Christopher J. Morrone <morrone2@llnl.gov> - 
- Initial build.
